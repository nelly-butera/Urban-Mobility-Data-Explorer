<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NYC Taxi Analytics â€” Tip Intelligence</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <div class="app-shell">

    <!-- Header -->
    <header class="app-header">
      <a href="index.html" class="header-brand">
        <div class="brand-icon">ðŸš•</div>
        <div class="brand-text">
          <span class="brand-title">TaxiMetrics</span>
          <span class="brand-subtitle">NYC Mobility Intelligence</span>
        </div>
      </a>

      <div class="ticker" aria-hidden="true">
        <div class="ticker-inner">
          <span class="ticker-item">MANHATTAN TIP AVG <span class="up">18.6%</span></span>
          <span class="ticker-item">CARD PREMIUM <span class="up">+14.2pp vs CASH</span></span>
          <span class="ticker-item">PEAK TIP HOUR <span class="up">02:00</span></span>
          <span class="ticker-item">WEST VILLAGE <span class="up">20.3% avg tip</span></span>
          <span class="ticker-item">STATEN ISLAND <span class="down">9.7% avg tip</span></span>
          <span class="ticker-item">MANHATTAN TIP AVG <span class="up">18.6%</span></span>
          <span class="ticker-item">CARD PREMIUM <span class="up">+14.2pp vs CASH</span></span>
          <span class="ticker-item">PEAK TIP HOUR <span class="up">02:00</span></span>
          <span class="ticker-item">WEST VILLAGE <span class="up">20.3% avg tip</span></span>
          <span class="ticker-item">STATEN ISLAND <span class="down">9.7% avg tip</span></span>
        </div>
      </div>

      <div class="header-meta">
        <div class="meta-tag">
          <span class="meta-dot"></span>
          LIVE
        </div>
        <div class="meta-tag">JAN 2024</div>
      </div>
    </header>

    <!-- SIDEBAR NAV -->
    <nav class="app-nav" aria-label="Main navigation">
      <div class="nav-section-label">Dashboards</div>
      <a href="index.html" class="nav-link">
        <span class="nav-icon">â—‰</span>
        Overview
      </a>
      <a href="profitability.html" class="nav-link">
        <span class="nav-icon">ðŸ“ˆ</span>
        Profitability
      </a>
      <a href="tips.html" class="nav-link active">
        <span class="nav-icon">ðŸ’¡</span>
        Tip Intelligence
      </a>
      <a href="anomalies.html" class="nav-link">
        <span class="nav-icon">âš </span>
        Anomalies
        <span class="nav-badge">4.9k</span>
      </a>

      <div class="nav-footer">
        Data period: <span>Jan 2024</span><br>
        Records: <span>880,345</span>
      </div>
    </nav>

    <!-- â•â•â• MAIN CONTENT â•â•â• -->
    <main class="app-main">

      <div class="page-header">
        <div class="page-title-block">
          <div class="page-eyebrow">Behavioral Analytics</div>
          <h1 class="page-title">Tip Intelligence</h1>
          <p class="page-subtitle">Tipping patterns by borough, time of day, and payment method</p>
        </div>
      </div>

      <!-- Insight Box -->
      <div class="insight-box animate-in">
        <div class="insight-label">AI Insight</div>
        <p class="insight-text" id="tip-insight">
          Generating insightsâ€¦
        </p>
      </div>

      <!-- Charts Row 1 -->
      <div class="charts-grid charts-grid-2" style="margin-bottom:20px;">

        <div class="chart-card animate-in">
          <div class="chart-header">
            <div>
              <div class="chart-title">Average Tip % by Borough</div>
              <div class="chart-subtitle">Mean tip percentage on card transactions</div>
            </div>
          </div>
          <div class="chart-canvas-wrap">
            <canvas id="chart-tip-borough" aria-label="Bar chart: average tip percent by borough"></canvas>
          </div>
        </div>

        <div class="chart-card animate-in">
          <div class="chart-header">
            <div>
              <div class="chart-title">Tip % by Hour of Day</div>
              <div class="chart-subtitle">Average tip rate across 24-hour cycle</div>
            </div>
            <div class="chart-legend">
              <div class="legend-item">
                <div class="legend-dot" style="background:#3dd68c"></div>
                Tip %
              </div>
            </div>
          </div>
          <div class="chart-canvas-wrap">
            <canvas id="chart-tip-hour" aria-label="Line chart: tip percent by hour"></canvas>
          </div>
        </div>

      </div>

      <!-- Card vs Cash Chart -->
      <div class="chart-card animate-in">
        <div class="chart-header">
          <div>
            <div class="chart-title">Card vs. Cash Tip % by Borough</div>
            <div class="chart-subtitle">Comparison of payment method impact on tipping behavior</div>
          </div>
          <div class="chart-legend">
            <div class="legend-item">
              <div class="legend-dot" style="background:#f5c518"></div>
              Card
            </div>
            <div class="legend-item">
              <div class="legend-dot" style="background:#60a5fa"></div>
              Cash
            </div>
          </div>
        </div>
        <div class="chart-canvas-wrap">
          <canvas id="chart-tip-payment" aria-label="Grouped bar chart: card vs cash tip rates by borough"></canvas>
        </div>
      </div>

      <!-- Tip breakdown stats -->
      <div class="charts-grid charts-grid-2" style="margin-top:20px;">
        <div class="chart-card animate-in">
          <div class="chart-title" style="margin-bottom:16px;">Tip Rate by Zone â€” Top 10</div>
          <table style="width:100%;border-collapse:collapse;font-size:12px;">
            <thead>
              <tr style="background:var(--bg-elevated);">
                <th style="padding:8px 12px;text-align:left;font-family:var(--font-mono);font-size:9px;letter-spacing:0.12em;color:var(--text-muted);">Zone</th>
                <th style="padding:8px 12px;text-align:left;font-family:var(--font-mono);font-size:9px;letter-spacing:0.12em;color:var(--text-muted);">Avg Tip %</th>
                <th style="padding:8px 12px;text-align:left;font-family:var(--font-mono);font-size:9px;letter-spacing:0.12em;color:var(--text-muted);">Bar</th>
              </tr>
            </thead>
            <tbody id="tip-zone-table">
            </tbody>
          </table>
        </div>

        <div class="chart-card animate-in">
          <div class="chart-title" style="margin-bottom:12px;">Key Metrics</div>
          <div style="display:flex;flex-direction:column;gap:14px;" id="tip-kpi-mini">
          </div>
        </div>
      </div>

    </main>
  </div>

  <script src="js/main.js"></script>
  <script>
    // Populate zone tip table and mini KPIs after main.js runs
    document.addEventListener('DOMContentLoaded', () => {
      // Wait for initTips to run
      setTimeout(() => {
        const tbody = document.getElementById('tip-zone-table');
        if (tbody) {
          const sorted = [...DATA.topZones].sort((a,b) => b.avgTip - a.avgTip);
          const maxTip = Math.max(...sorted.map(z => z.avgTip));
          tbody.innerHTML = sorted.map((z, i) => `
            <tr style="border-bottom:1px solid var(--border);">
              <td style="padding:10px 12px;color:var(--text-primary);font-size:12px;">${z.zone}</td>
              <td style="padding:10px 12px;font-family:var(--font-mono);color:var(--green);">${z.avgTip.toFixed(1)}%</td>
              <td style="padding:10px 12px;min-width:80px;">
                <div class="progress-bar"><div class="progress-fill green" style="width:${(z.avgTip/maxTip*100).toFixed(1)}%"></div></div>
              </td>
            </tr>`).join('');
        }

        const mini = document.getElementById('tip-kpi-mini');
        if (mini) {
          const metrics = [
            { label: 'Card Avg Tip',   value: '20.4%', color: 'var(--yellow)' },
            { label: 'Cash Avg Tip',   value: '3.4%',  color: 'var(--blue)' },
            { label: 'Card Premium',   value: '+17.0pp', color: 'var(--green)' },
            { label: 'Peak Tip Hour',  value: '02:00', color: 'var(--text-primary)' },
            { label: 'Peak Borough',   value: 'Manhattan', color: 'var(--yellow)' },
          ];
          mini.innerHTML = metrics.map(m => `
            <div style="display:flex;justify-content:space-between;align-items:center;padding-bottom:10px;border-bottom:1px solid var(--border);">
              <span style="font-size:12px;color:var(--text-secondary);">${m.label}</span>
              <span style="font-family:var(--font-mono);font-size:14px;color:${m.color};font-weight:600;">${m.value}</span>
            </div>`).join('');
        }
      }, 100);
    });
  </script>
</body>
</html>
